<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="kiyo,jixusen@yahoo.co.jp"><title> · kiyo's Blog</title><meta name="description" content="自定义ComponentScan扫描规则默认情况下，ComponentScan会将基础包中带@Component, @Repository, @Service, @Controller以及自定义Component注解的类作为候选组件。如果需要自定义ComponentScan的扫描规则，可以通过指定i"><meta name="keywords" content="Spring,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/myblog/css/style.css"><link rel="stylesheet" href="/myblog/css/blog_basic.css"><link rel="stylesheet" href="/myblog/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/myblog/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/myblog">kiyo's Blog</a></h3><div class="description"><p>菜鸟程序员日常.</p></div></div></div><ul class="social-links"></ul><div class="footer"><a href="/myblog">kiyo 2017<div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Published with Hexo&#65281;</a></div></a></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/myblog">首页</a></li><li><a href="/myblog/about">关于</a></li><li><a href="/myblog/archives">归档</a></li><li><a href="/myblog/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" style="display:none;" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/myblog/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a></a></h3></div><div class="post-content"><h4 id="自定义ComponentScan扫描规则"><a href="#自定义ComponentScan扫描规则" class="headerlink" title="自定义ComponentScan扫描规则"></a>自定义ComponentScan扫描规则</h4><p>默认情况下，ComponentScan会将基础包中带@Component, @Repository, @Service, @Controller以及自定义Component注解的类作为候选组件。如果需要自定义ComponentScan的扫描规则，可以通过指定<em>includeFilters</em>和<em>excludeFilters</em> 参数的方式实现。每一个filter都需要配置type属性和expression属性，前者指定过滤的类型，后者表示相应的过滤规则。下面是可供配置的Filter一览：</p>
<p><strong><em>annotation</em></strong></p>
<p>annotation 是默认的过滤类型，表示以具有某些注解的组件作为过滤对象，配置expression时指定对应的注解类即可，比如下面这个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>,</span><br><span class="line">                includeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(&#123;Controller.class, Service.class&#125;)&#125;,</span><br><span class="line">                excludeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(Repository.class)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>assignable</em></strong></p>
<p>assignable表示以隶属于某些类/接口的组件作为过滤对象，配置expression时指定对应的class/interface即可，比如下面这个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的classes相当于指定了expression</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>,</span><br><span class="line">                includeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.ASSIGNABLE_TYPE,</span><br><span class="line">                                                        classes = BaseService.class)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>aspectj</em></strong></p>
<p>aspectj表示以符合特定aspectj表达式的组件作为过滤对象，配置expression时指定对应的表达式即可，比如下面这个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>,</span><br><span class="line">                includeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.ASPECTJ,</span><br><span class="line">                                                        pattern = <span class="string">"com.sample..Base*+"</span>)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>regex</em></strong></p>
<p>regex表示以符合特定正则表达式表达式的组件作为过滤对象，配置expression时指定对应的表达式即可，比如下面这个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>,</span><br><span class="line">                includeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.REGEX,</span><br><span class="line">                                              pattern = <span class="string">"com\.sample\.[^.]+\.[^.]+(Impl)"</span><span class="string">")&#125;)</span></span><br><span class="line"><span class="string">public class Config &#123;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong><em>custom</em></strong></p>
<p>如果上面的几种方式都无法满足要求的话，还可以通过实现<code>TypeFilter</code> 接口的方式实现自定义的Filter。比如下面这个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>,</span><br><span class="line">                includeFilters = &#123;<span class="meta">@ComponentScan</span>.Filter(type = FilterType.CUSTOM,</span><br><span class="line">                                                        classes = MyTypeFilter.class)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外，Spring还支持将默认的扫描规则关闭，只需要如下配置即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>, useDefaultFilters = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="在-Component注解类中定义-Bean工厂方法"><a href="#在-Component注解类中定义-Bean工厂方法" class="headerlink" title="在@Component注解类中定义@Bean工厂方法"></a>在@Component注解类中定义@Bean工厂方法</h4><p>通常情况下，我们会选择在标注@Configuration的配置类中配置@Bean注解的工厂方法。其实在@Component标注的类中也可以配置@Bean注解的工厂方法，只不过两者存在一些区别，下面就通过一些实例来看一下到底存在什么区别吧。</p>
<p><strong>@Configuration注解类由CGLIB增强</strong></p>
<p>标注有@Configuration注解的配置类会由CGLIB进行增强，因此在调用@Bean注解的工厂方法时会有拦截增强的过程，而@Component注解的类则没有这种特性，具体看下面这个例子：</p>
<p><strong><em>这种说法有一个例外，当@Bean注解的是static方法时将不存在代理增强，这是由CGLIB的特性决定的，CGLIB是通过继承被代理类并重写其方法来实现代理增强的，而static方法无法被重写。</em></strong></p>
<p>@Configuration注解类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.sample"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Component注解类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Plane</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException </span>&#123;</span><br><span class="line"></span><br><span class="line">    ApplicationContext applicationContext = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config.class);</span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">"config"</span>).getClass());</span><br><span class="line">    System.out.println(applicationContext.getBean(<span class="string">"plane"</span>).getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class com.sample.Config$$EnhancerBySpringCGLIB$$a15e8179</span><br><span class="line">class com.sample.Plane</span><br></pre></td></tr></table></figure>
<p>从上面的运行结果可以看到，@Configuration注解类的确经过了CGLIB代理增强。</p>
<p><strong><em>另外，无论是@Component还是@Configuration，其注解类的父类中定义的@Bean方法也能被Spring框架发现。</em></strong></p>
<h4 id="自定义-Component注解Bean的命名规则"><a href="#自定义-Component注解Bean的命名规则" class="headerlink" title="自定义@Component注解Bean的命名规则"></a>自定义@Component注解Bean的命名规则</h4><p>默认情况下，当一个由@Component注解的类被装配时，注解属性value的配置内容会作为Bean的名字，而当value没有被配置时一个小写开头的简单类名会被使用。如果需要自定义命名规则，可以像下面这样指定BeanNameGenerator接口实现类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"org.example"</span>, nameGenerator = MyNameGenerator.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.example"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name-generator</span>=<span class="string">"org.example.MyNameGenerator"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-02-02</span></div></div></div></div></div></div></div></div><script src="/myblog/js/jquery.js"></script><script src="/myblog/js/jquery-migrate-1.2.1.min.js"></script><script src="/myblog/js/jquery.appear.js"></script></body></html>