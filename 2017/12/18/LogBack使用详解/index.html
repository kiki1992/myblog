<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="kiyo,jixusen@yahoo.co.jp"><title>Logback使用笔记（更新中 最后更新时间2017-12-20） · kiyo's Blog</title><meta name="description" content="Logback简介Logback是由大名鼎鼎的日志系统Log4j创始人Ceki Gülcü主导开发的又一开源日志系统。作为Log4j的后继项目，Logback在很多方面都优于现存其他日志系统。除此之外，它还提供了许多其他日志系统中没有且实用的特性。
使用Logback时可以配合SLF4J日志门面。作"><meta name="keywords" content="Spring,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/myblog/css/style.css"><link rel="stylesheet" href="/myblog/css/blog_basic.css"><link rel="stylesheet" href="/myblog/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/myblog/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/myblog">kiyo's Blog</a></h3><div class="description"><p>菜鸟程序员日常.</p></div></div></div><ul class="social-links"></ul><div class="footer"><a href="/myblog">kiyo 2017<div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Published with Hexo&#65281;</a></div></a></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/myblog">首页</a></li><li><a href="/myblog/about">关于</a></li><li><a href="/myblog/archives">归档</a></li><li><a href="/myblog/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/myblog/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Logback使用笔记（更新中 最后更新时间2017-12-20）</a></h3></div><div class="post-content"><h2 id="Logback简介"><a href="#Logback简介" class="headerlink" title="Logback简介"></a>Logback简介</h2><p>Logback是由大名鼎鼎的日志系统Log4j创始人Ceki Gülcü主导开发的又一开源日志系统。作为Log4j的后继项目，Logback在很多方面都优于现存其他日志系统。除此之外，它还提供了许多其他日志系统中没有且实用的特性。</p>
<p>使用Logback时可以配合SLF4J日志门面。作为一个用于日志系统的简单Facade，SLF4J可以服务于各个日志系统，因此你可以在需要的时候方便地替换实际使用的日志系统。值得一提的是，SLF4J同样也是由Ceki Gülcü主导开发的。</p>
<p>要开始使用Logback，只需要引入以下jar包依赖：<br><em>logback-core.jar</em>   <em>logback-classic.jar</em> – 本文发布时的jar包版本为1.1.11<br>如果需要配合SLF4J使用，那么还需要引入以下jar包依赖：<br><em>slf4j-api.jar</em>  – 本文发布时的jar包版本为1.7.25</p>
<h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><p>Logback可以基于xml或者groovy配置，这里只记录xml的配置方法。首先来看一个配置的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"debug"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="configuration节点配置"><a href="#configuration节点配置" class="headerlink" title="configuration节点配置"></a>configuration节点配置</h3><p>xml配置的根节点为configuration，可以自定义debug和scan属性。</p>
<p>configuration节点可以由0到多个appender节点，0到多个logger节点以及一个root节点构成。</p>
<h4 id="debug属性"><a href="#debug属性" class="headerlink" title="debug属性"></a>debug属性</h4><p>配置debug属性为true时，Logback会输出记录其内部状态的日志，前提是配置文件存在且格式正确。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="scan属性"><a href="#scan属性" class="headerlink" title="scan属性"></a>scan属性</h4><p>配置scan属性为true可以让Logback在配置文件发生变化时自动重载，它有一个配套的属性scanPeriod来定义扫描的间隔，可以配置的单位有[milliseconds, seconds, minutes,hours]，默认使用milliseconds，建议配置时带上单位。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">"true"</span> <span class="attr">scanPeriod</span>=<span class="string">"10 seconds"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong><em>需要注意的是，</em></strong>上面配置的扫描间隔并不代表配置文件重载扫描真正执行的时间间隔，只有当执行了N次日志输出操作并且过了扫描间隔之后才会触发配置文件的重载扫描操作。而这里的N也不是一个固定值，其取值取决于当前应用输出日志的频率。N的一个参考值是默认值16，在一些CPU密集型的应用中这个值可以达到2^16 (= 65536)。</p>
<h3 id="Logger节点配置"><a href="#Logger节点配置" class="headerlink" title="Logger节点配置"></a>Logger节点配置</h3><p>Logger节点可以配置name,level以及additivity属性，除了name属性以外其他两个属性都是可选配置。<br><strong><em>name属性: </em></strong> 定义logger的标示，一般使用包名或者类名。<br><strong><em>level属性: </em></strong> 可以指定TRACE, DEBUG, INFO, WARN, ERROR, ALL或 OFF，以及特殊值INHERITED/NULL(代表强制继承父logger的level配置)。如果省略level属性就会继承父logger的配置。<br>关于logger的level属性继承可以看下面这个例子：<br><img src="/myblog/images/Logback/logger-inherit.png" alt="logger-inherit"><br>可以看到在名为a.b.c的logger在没有指定level属性的情况下继承了父logger-a.b的level设置。而图中的ROOT表示root节点，它是所有logger的祖先。因此在父logger及其他祖先logger都没有配置level属性时，当前logger会继承ROOT的配置。<br><strong><em>additivity属性: </em></strong> 指定logger是否继承父logger输出源appender，如果指定为false，则子logger只会在自己定义的appender中输出日志，默认为true。<br>Logger节点可以包含多个appender-ref子节点来指定日志的输出源<br><strong><em>appender-ref节点: </em></strong>通过节点的ref属性配置指定的输出源appender<br><strong>配置例</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.demo"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"FILEOUT"</span> /&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="root节点配置"><a href="#root节点配置" class="headerlink" title="root节点配置"></a>root节点配置</h3><p>root节点其实就是一个特殊的logger节点，只不过它只有一个必须属性level。至于为什么没有logger的name和additivity属性，原因很简单，root logger的名字就是ROOT无法更改自然就没有name属性，而root logger又是所有logger的祖先所有也就不存在继承appender的属性additivity了。<br>另外，和其他logger一样，root logger同样支持指定多个输出源appender。<br><strong>配置例</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"FILEOUT"</span> /&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="变量替换配置"><a href="#变量替换配置" class="headerlink" title="变量替换配置"></a>变量替换配置</h3><p>Logback支持变量的动态替换，变量替换使用${}表达式。用于替换的变量值可以来自当前文件，Logback的上下文，JVM运行时参数以及环境变量。</p>
<h4 id="变量配置"><a href="#变量配置" class="headerlink" title="变量配置"></a>变量配置</h4><p><strong>xml配置</strong><br>xml配置中可以使用property或者variable节点配置单个变量或者从外部文件/资源中获取多个变量配置。<br>如果是直接定义一个变量可以如下配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logpath"</span> <span class="attr">value</span>=<span class="string">"/home/demo/app.log"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"FILE"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.FileAppender"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;logpath&#125;<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>如果需要从外部文件/资源获取多个变量可以如下配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">&lt;!-- 从文件系统读取 --&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">file</span>=<span class="string">"/home/demo/config/logback.properties"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 从classpath读取 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">resource</span>=<span class="string">"logback.properties"</span> /&gt;</span> </span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p><strong>java系统变量配置</strong><br>如果需要通过java系统变量配置，可以直接在命令行做如下指定：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dlogpath="/home/demo/app.log" MyApp</span><br></pre></td></tr></table></figure></p>
<p><strong>通过JNDI获取</strong><br>动态变量值还可以通过JNDI获取，默认获取的变量有效范围为local，具体配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">insertFromJNDI</span> <span class="attr">env-entry-name</span>=<span class="string">"java:comp/env/appName"</span> <span class="attr">as</span>=<span class="string">"appName"</span> <span class="attr">scope</span>=<span class="string">"system"</span> /&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h4 id="变量值替换"><a href="#变量值替换" class="headerlink" title="变量值替换"></a>变量值替换</h4><p><strong>普通替换</strong><br>变量值替换使用${}标签，配置例如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.demo"</span> <span class="attr">level</span>=<span class="string">"$&#123;demoLoggerLevel&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p><strong>默认值设置</strong><br>变量值的替换支持默认值设置，配置例如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">&lt;!-- 默认logger等级debug --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.demo"</span> <span class="attr">level</span>=<span class="string">"$&#123;demoLoggerLevel:-DEBUG&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p><strong>变量嵌套</strong><br>变量值的替换还支持嵌套配置，即可以在${}中嵌套其他${}表达式。配置例如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">&lt;!-- 默认值动态配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.demo"</span> <span class="attr">level</span>=<span class="string">"$&#123;demoLoggerLevel:$&#123;defaultLevel&#125;&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 变量名配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"$&#123;$&#123;demoLogger&#125;.name&#125;"</span> <span class="attr">level</span>=<span class="string">"$&#123;$&#123;demoLogger&#125;.level&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h4 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h4><p>使用xml配置变量时可以指定变量的作用域，指定时使用scope属性。scope的取值可以是local,context,system，默认为local。<br>以下是对各个作用域的简单描述：<br><strong><em>local: </em></strong>定义为local作用域的变量只在当前配置文件有效。<br><strong><em>context: </em></strong>定义为context作用域的变量在整个上下文生命周期内有效。<br><strong><em>system: </em></strong>定义为system作用域的变量会作为JVM的系统变量，因此在JVM运行期间都有效。<br><strong>Logback替换变量时的搜索顺序: </strong>local-&gt;context-&gt;system-&gt;OS(系统环境变量)</p>
<h4 id="默认变量"><a href="#默认变量" class="headerlink" title="默认变量"></a>默认变量</h4><p>Logback默认会自动添加两个变量，分别是HOSTNAME和CONTEXT_NAME，其中CONTEXT_NAME的取值可以通过contextName标签来自定义配置，<strong>自定义配置的好处是：当有多个应用使用同一个logger输出日志时，可以方便地区分是哪个应用输出的日志。</strong>。<br>自定义CONTEXT_NAME的例子如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">  <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>myAPP<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-12-18</span><i class="fa fa-tag"></i><a href="/myblog/tags/日志框架/" title="日志框架" class="tag">日志框架 </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://blog.kiyo.top/2017/12/18/LogBack使用详解/,kiyo's Blog,Logback使用笔记（更新中 最后更新时间2017-12-20）,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/myblog/2017/12/20/Executor&amp;ExecutorService源码笔记/" title="Executor相关接口源码笔记" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/myblog/2017/12/14/CountDownLatch源码笔记/" title="CountDownLatch源码笔记" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/myblog/js/jquery.js"></script><script src="/myblog/js/jquery-migrate-1.2.1.min.js"></script><script src="/myblog/js/jquery.appear.js"></script></body></html>